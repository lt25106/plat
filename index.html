<!DOCTYPE html>
<html>
  <style>
    * {
      margin: 0;
      padding: 0;
    }
    html, body {
      height: 100%;
      overflow: hidden;
    }
    canvas {
      image-rendering: pixelated;
      display: block;
    }
  </style>
  <body>
    <canvas></canvas>
    <script>
      const canvas = document.querySelector("canvas");
      const ctx = canvas.getContext("2d");

      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;

      const TILE = 64;
      const player = new Image();
      const dirt = new Image();
      const lava = new Image();
      const grass = new Image();
      player.src = "noteblock.png";
      dirt.src = "dirt.png";
      lava.src = "lava.png";
      grass.src = "grass.png";

      let x = 0;
      let y = canvas.height - TILE * 3;
      let dx = 0;
      let dy = 0;
      let gravity = 0.5;
      let jumping = false;

      const levels = [
        [
          "........................",
          "........................",
          "........................",
          "....................###.",
          "....................###.",
          "..........#####......###",
          "....................###.",
          "....................###.",
          "########################",
          "########################"
        ],
        [
          "........................",
          "........................",
          "..................###...",
          ".............###........",
          "........................",
          "..........###...........",
          "........................",
          "....###................L",
          "########################",
          "########################"
        ]
      ];

      let currentLevel = 0;

      function drawLevel() {
        const level = levels[currentLevel];
        for (let row = 0; row < level.length; row++) {
          for (let col = 0; col < level[row].length; col++) {
            const tile = level[row][col];
            const xPos = col * TILE;
            const yPos = row * TILE;
            if (tile === "#") {
              ctx.drawImage(dirt, xPos, yPos, TILE, TILE);
            } else if (tile === "L") {
              ctx.drawImage(lava, xPos, yPos, TILE, TILE);
            } else if (tile === ".") {
              // empty tile, skip
            }
          }
        }
      }

      function isLava(x, y) {
        const level = levels[currentLevel];
        const row = Math.floor(y / TILE);
        const col = Math.floor(x / TILE);
        return level[row] && level[row][col] === "L";
      }

      function reachedEnd() {
        return x + TILE > canvas.width;
      }

      function resetPlayer() {
        x = 0;
        y = canvas.height - TILE * 3;
        dx = 0;
        dy = 0;
      }

      function gameLoop() {
        x += dx;
        dy += gravity;
        y += dy;

        // Floor collision
        if (y >= canvas.height - TILE * 2) {
          y = canvas.height - TILE * 2;
          dy = 0;
          jumping = false;
        }

        // Lava check
        if (isLava(x + TILE / 2, y + TILE)) {
          alert("You died in lava!");
          resetPlayer();
        }

        // Level complete check
        if (reachedEnd()) {
          currentLevel++;
          if (currentLevel >= levels.length) {
            alert("You finished all levels!");
            currentLevel = 0;
          }
          resetPlayer();
        }

        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.imageSmoothingEnabled = false;

        drawLevel();
        ctx.drawImage(player, x, y, TILE, TILE);

        requestAnimationFrame(gameLoop);
      }

      function setd(key) {
        if (key.key === "ArrowLeft") dx = -6;
        if (key.key === "ArrowRight") dx = 6;
        if ((key.key === "ArrowUp" || key.key === " ") && !jumping) {
          dy = -10;
          jumping = true;
        }
      }

      function stop(key) {
        if (key.key === "ArrowLeft" || key.key === "ArrowRight") dx = 0;
      }

      document.addEventListener("keydown", setd);
      document.addEventListener("keyup", stop);

      requestAnimationFrame(gameLoop);
    </script>
  </body>
</html>
